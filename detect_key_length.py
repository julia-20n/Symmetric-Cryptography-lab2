import matplotlib.pyplot as plt
from collections import Counter

ALPHABET = 'абвгдежзийклмнопрстуфхцчшщъыьэюя'

def preprocess_text(text):
    return ''.join([c.lower() for c in text if c.lower() in ALPHABET])

def split_text_into_blocks(ciphertext, r):
    blocks = ['' for _ in range(r)]
    for i, char in enumerate(ciphertext):
        blocks[i % r] += char
    return blocks

def index_of_coincidence(text):
    N = len(text)
    if N <= 1:
        return 0.0
    freqs = Counter(text)
    return sum(f * (f - 1) for f in freqs.values()) / (N * (N - 1))

def estimate_key_length(ciphertext, max_r=30):
    results = []
    for r in range(1, max_r + 1):
        blocks = split_text_into_blocks(ciphertext, r)
        i_r_values = [index_of_coincidence(block) for block in blocks]
        avg_ir = sum(i_r_values) / len(i_r_values)
        results.append((r, avg_ir))
    return results

def plot_results(results):
    r_values = [r for r, _ in results]
    i_values = [i for _, i in results]

    plt.figure(figsize=(10, 6))
    plt.plot(r_values, i_values, marker='o')
    plt.title("Оцінка довжини ключа шифру Віженера (рос. мова)")
    plt.xlabel("Ймовірна довжина ключа (r)")
    plt.ylabel("Середній індекс відповідності")
    plt.grid(True)
    plt.xticks(r_values)
    plt.show()

def main():
    ciphertext = """
    деьооуцмдурьдыегныьпуыккэаонтцчхлуучктвдджоаубуяцбхкугбэщешряцзывтшщяшхтяяуюйлрънпрйбдшзъняъмйнуьря
пьщгтуьзразхтпфгяжитхчьурвттдфанвзгьячрщюитобущузсшзпуыхнмвбуъняэаоемйнеорцбэзмюцйхлыпейжцбышяпщчсу
щкдбкалтозьевефямнумвеаыяпцезьуотпъяуччтшкъуньдцплчжурпэнямноннщтвддщоюнгкшцкуьщщдднтютэнцьмухрчбв
щгртчпщыупшоыуфщгхнжхуучехфщвчыыэееъщахььрхобщглэччзекцьэахатггъесюекчпнрщчозьтчмуцгшъмьаьлефуьррар
ишужыэюваелунэкззфвьюррвтецэцжемпвжшралризщцоьпнвхчхньтьцъоннтдфаъняэаозжярптлйжцщшрзтоьавхтмечэумэа
гнюявстуьччцрэезшсцхзяршуъхтанвчыбгпэзчбаьбхючрлщхткгзгьумыкэецрпшьтьатьдэкякоьпклэябфугэущфщазсфвйгтьр
ъеюаноннъвыанрзбчехуцокржзввщцшсъуньтнхквеачцвуэкшоучктвдджлрззесупютпфъцщпюзчдуызиххгусннтцхцньалтй
бпяувфкдкмйнеовяпкрртуьищюрйчрчбгркртяпщсжечзцыцркртяищюрйкпьщчцдчтеопьтункфхбщрыкытуужкыбжпэрстць
цутзркйфвчвыонйуцкмущрббйллтамупцнечвзюъбтзчелрахчэжьхъэдыбдуоьупкйфюуюпъндрйтзошжьаахзефетлаххпмвеа
ыъхпчпыомуьъщюнгйшряшццфпкужувлэвццшфакзыдвсгхнаркфюыввьрадфрсхтьслщржефряасдвчкчкрнкчкщудлбшмген
ьйзъвншяудъчесюрткцзбыьщвфежхртрпбзябфрйртьжжщзюпрхмчьсткдтжъинмржанчзцнвупцпуфрцдфщдщжьхцьекковщ
чэалчувэьсхшужбапмрнюхлхпумкшааьсхоокцьдкбзеэаонеезехазхкмжбщшяхчцтруучпужхчшмшпятръркозябьлррчуцкэр
йшгбознняхецщрбчшнрэаанзшиплхвчжщжбдлйшквгпцмефофхвлютрьтуупкъзшэаргрзечшужехзюбъьйрчусрябыкжцуялж
рйксрюхткуццаынфкдкхцлжпньэантзнйкцкехпщщдьщвюдюахооууфвхтызйзтушуоцхэмуэуйютььшьртлэяътчдзейкцупчп
олеанрхиыепоикмрлшязфюхеэюмсунршжфжфюйярншвршъфиъьжютйнхьончзггччдэтезэусршогуэзсютчзлазнсрбеъхтэкъ
умйнзбзйючуцрцтзвучрпкыдчынщмчсгцкпшешуфжмшсчръутубкбанфмюлочщпэубкбыдзйрхчтпоъчшкббшюмхиежжщдь
пчвюовзъкярудрпкйфюаьывуэкмйнумщщиэрсрпбехьпзызцгччюяхцчлщзишдгбцшюваазщюрччкюбяшнбнвчръпапрлэъят
деапюбънсвюютпътевзларотмвццлррйярьнпетйцбщвзъейуъюкпкйпхтцоюйднчофбмздиапмшсирщррсэяжбхщцхрезршвтк
гясцлкюцуфщяфуйпббчумхфзкщтрртовшгэпхсвкшцзуфтзщъэыбкшдщпрршщюбыьнчйччзязжпффэгхячейбябфрйтюбдщп
локкпцпнхгпшхщжрюячущгашфцачгмшъщрунпнужщьгэбшчьрзырцьюдущппрлчрлуеущхчуэлгххэецодфшужбсшмюойх
рррипкходзлюльчпщбчшевкдщалужхлржеьюсееьбюгзумьучжуцбчщстхчюрыккфпфддщюйкгшщыдцпешузняынвфыьър
шзьеавдууднхьейкпщфнцншйзкныккййпэъхнвузарьпфъзгбцлбрршаццжрйпщцанргюдуьакчпищэтцнинямщыфнфмзчтщм
яхцчлщудшфшшыьстнйкцкпууиьъяунъебмнбщкчмфэбыдъхчцрыехпщщдьуипмтпоьдуъкябяьнбрчйхцозетфщчшзхсяплш
гамжвэттявквбьадуыдвызькюзжхузххтдчюттзяуыткрсехзкввщзчтецущвтьтвваьзьаирзядуигщюъхнтччпсуучктфюгкжрфз
дэофбмцзеэкпфрцтрсрженьтгшъвувбхьшнъмзюсыъшичмрапапужудззтпечщюэъсвггчдяыуибварттгзчохнуйчзбцтпэнугчт
яяхьюлщрцжхлшяуйрсщааьжньюбуецзжшжуьщзйпдуеъвябущзрезхккяыфхяъуатупхйжужудздчежхрзвркурвэщсбпчдцмг
умюжбпэнсавупщбтпевтгшнюфзкпункчпвътъпхюьтщцгеыффхвлжакпкшцклпкгбщнныкднуямхедфюгкгыддкоьдцпешуп
цдькдчььоттфщюошъщьйуэьпкореэттяэтекуяошьпвшьщвфещищюрйптфъврчрряйыооеьклшгхзщпзшсьмнхклыдлкмтхнц
цщеупзсдщнэфеплекзкнчбэщбюояищррхтнжызщнэубушущтшффэдщсрпщцрлфущтщэвлрэуыехомжещщцашдтапрщруд
фрчбвщгртчхюжзттбзээщмхтядщаучэсяшяуюючжхлркрщтьхапзыньищрхтепьшзщсппчмлщрцжгпэтхнхкгшпунупуяыьэн
шмйунотнгзэбблжфащецывсшнщфчшзыныуаьжнхкеюеазюпчпщчпнлхшпбынъеюкоцоткйьддщбшрязутзртмяугьмггыечб
сусжббфрцххесььцназдбюэнютеьрыюзшнббфлкбдязьуеумрдыэхяъжтьрсртпдплэщяэежкпоеунклшгхзецезравъшпггаьсю
шътраврчведфщдоуичщюрлчрееойлэнйкцкпуыфрсъьбюнгнвцучшцзеэкпэагнььржъвъшяуюьндеьезчьрчбйэнтуййррошру
юбыуехтипщченцпфъъкфьувупуибмзшшдьдсдышыырубзбпкюлшчщпцоуцкчфиьлйсадкпьършжватвяыбичновъфвюфнвд
уудкнйършклеаррыншнтрфуърчбьцябцчньшнгбкжпбрсаущелцйьпфцшвэнууьищюрзкфвфнцнсаеьрыюъштвлауцвуэкьррн
цкцъцщфрсятжаюкцуцбъчзвкгтжъкубмфяъшясрьйшьоскнщаохньряырхпепфщятцдэббучщкыпмфэеанаббещыжемкяатьб
бкмнчйхцьхгуэурсещркщкфпфдбфюзхиехщрхжкняваънткыкшцацкифюъуфяуыеыуучтдюбябдъудыщркцфнтктцзшфьчыь
детзчбвщбржтрщбпкнреевлмэуьумймтшдщаърфюйячзэрткъьяьняачяхлъсхтжщеьюцшчьрйябйпфьяаццшчяплшгшофвкд
щсюзтцчофхтдфшдънбнынэлфефовюйлцрцыхюсротхэччэьвудетйдехрепешдуужуптзхркцудзгюжзарьфтшъщаъкрвущеыц
ыецкьбйрбшйдуаьжньююатчзбныкэкгахршюсшдууйдсунутчвчъцнэпдечарржмвваэньшочщящньвядфщдочезлюкюпуюбр
щапмчтшьучжааоевзвквдмьбртуршхщзфеэкпцткффвгущюыццзщасуокжшшрмрэяшвцфкхббувщгтцьсжяндгкэцэюаюпеф
щюбйшщбоыннбфячлыпаупфееывхтьзрцыкотьачщгэебусуячшфлшэщбхььпаьжнмъььфьдуйчзхонуввйыгтнэчяпщъжкъиф
юфытъемзьменцпфъъйххртъънфткжкудзкхчыеваритобущуэткибоьтуопфлъпяьажуьбгжшффяцщлрэднаяскфффээриэккцэ
ювнмвяыущюынибхомжербачюжэевнпбчумзбддннбчьцшннуыюггъшдьпкэлаюцфрдбюшнхняиыофбммфгджоюйщрунпн
пожуьуфыгыкфшвплзяыьщбчежуьщзйчкщччьювбждэывйавжпэрсттчэръеуършшгэяыншукаюцйдешхщаюдйцкстуцмвцан
нанйбъьуахвжпбурмсчмшомуцкжпгкцшчччзшпннкхбсэрпфесщсвчжгщчяжлгьячзстецржшъняэнщешйщлпнфтйэнвуиплх
вчжмфлэкмгрдуьывькнфътхтанвчыбгпэсвцэкгхрдецбпштсвеачтцкиплхврытфдгэяэущпщчжецэеюсдзхфехктрьчэщкъэяоч
яюрттнчвьееывхтьзлювмчэйетчаюпвкфцсхшщщштннвфейвцпнхкепшрсххжкццфуьрцбдщмюньцэкгкхкюбфсзызйучфзйш
ощццрзпфзупьнлкнхжвхзэзйучфзвьвъшцндабжхщакзодщгъчъзеичщркйпньдоуючтчррсрйшофляйэцнютзцжуцвжушрзбче
хунчехвжэацорпичлрпнсвшхъсйшыьржчтдодетьуфчежхрззттлвцвлмшььтучкеямфэужцхиетррээхргбгэмюкьцэкдхпжббть
йюхесшьзтпнръсэяъпчпъьиеххэдьлегчочщпзртмвхярзбфершнзчщрееанзютьрьбжефвбуьщпюзукчъвцхзгыллмхфецэывдч
рьачцычдиплхвчжщжбужръузучывдрзбдьщияхяццбеншпбшцрпцевнтяфхкчфкдщалудкчызйэофюъптатеепутлкнгбфлпре
лешоунйужувуйррьчгуучтжщдсэзэкйхрхдунрьвацнгсдуоьмуьрдоыхнуйччщяншркяхцрмйнбеацхспнюбчхяъцйхкэвчжяжб
длуртчцучучшбябужйэущкшыршодщгъьйакичуртшфкьхгрвфешуыърчкнвчящзвуэкьсншлрюыюнжфумучъпунрзщъамлто
кыойзпнвдоьорруткбгкхкюбфлалрчслщзтжмфтдщцэуцюушмхшдфеомъыеифщщришоябшлрмцжеэкртэмдофлкбдиищщрз
шлхоэщерхбупбътшдыуьыъваьйнутныфзктцрпзьчрюдфпщюшхюгхреццйъехкепфтгюъянтшхъчкцъцщфшмвунуынпкщяе
мъыуичыоътшсвчапдпресщыгуйнетьлйсаокоьпкмэмюахяъжткоьпксвдшщлкрщчтлякофвюфншдчешхлщкцждвгнуоючесн
яатшщрхъпдычзкньитезеанлтвхесхьейкопхюррвкпруренцпфъъйалрипюезтлнщччшзсавунцжтшщжбюшнуувгпывднкаатт
зпзбуэьтширблчцалрчцэювэчвггаэзттчзьуошыхншгэбгкъууефутжжывкгюсиучыропозкчцнткбшъьпеьхдшапзэубучбгахрж
тшхнюььтзбиээоуеешябзбрляуеяевхаызыудплшгаыффгткрмуйаьшвчжрхнсьмхтядьрркцхжтшркюскьюручмхбыялцвудкъ
ьчурзьрдщсгьячрщюиъзлшгхнууцмжшввьржкчцнткбзябфрйтщяасдвкикмусхпжеетнзвбьйнопкрзбыэьюшзчтурвтещхогэп
юуъркыхрыбцдтыящниплхврвхжыдргркызлызлппьюгкйрпфчщыкцьтфаящмрмдевцннфпфяящбюиешвцфкхбьддщпшняи
рьехкцьыярйюкъухьдехзбэачзееярлявзмклуътфюъвунэтнпчфюашмхуыншоуцпужгафбрхьтзшрошпабэщгюощаььмнууаж
хцъщцъхщъвйчэаывюйрсянъьннахцыцшнзчеищррхтфхугщлшзиечьойпнщцацнбпчпухгубмьфемтсшчушохлппщяацнфец
ррафхтжкудумючелррэцшмфтгэпюодекезхчрхганяппзеьырюпмфтапмшсирщррсчзшшфухрегеыъзркжьетхяпхчммцфткбм
жюшяпзикъьзчцвябвщрбнацхцзхшофагжзеумувуфьэфркдщсрпямлщюкьууцацнбничжъуспчвязлфръчфрюдупреаанявквб
шьзмчвюбюьстуипщрврппюуюутэеифщъпгщтвыщщчыудеуъзттпфиепзакбчщювцъзшыгюпюзтъшосхйищаящръшотжгск
овчбхщбъуйуыйзнчвьячшзэайуаьждьсвбукжртдуьакзотзцфугшсдунобеютвчъэятуюхщткркурыщъдэамупцффшжхбйрмпц
уъщгрьпфгбчэоыдпкэьпеысщютьцгзичньозтажхъэплфечщъзюптвятшршкркурукяпфдавяаущецодцпчшушрахряпщрвучсв
чгркътьоуямесвядэлгъукржпвдыюауэщпюцинфямнубыоььбюкхтрфпуыфрсъъпшдйтщмйзэщббгэыотчфщъкткзжчврбэкъх
резцфкэрдщоюруцэцнупльбялрвевеыоуцфвыофлсмкгшьехзыфцбюутскынэунбчрлеанврйцььшрсэзыччюмхкьцэкчшьрдуя
лфгчехрфкзпфаующцъеячлъфефкщцвючшччпуужачкжуьудъешехцхъшчябфэъъзттлхэзкаждсхясебечцвпкгфэъгзэпчсуцде
ъбжжяуфсузюьштеыпщаохзьняцьцпкчююыюусрпеоншхцчээетхнщзбшьыэобфвввщрвуклляурэъфюъчъбркэлщкнмжджхн
рхъдеььукчкяуапмрнйесуоаынрузщпюэежжцчфшищаъэывнмуьшвмкнфяяргшхьпэьтэкопхгроюььсюарзысвяяукшьйушоъ
жпньэанмхльтлакткожшбрпмпчмлщрцжужгтшмлсочщъэйшуьибщпъебчщызмкощктцзбущкыжзтчрзвеьйррянтркйэффэей
брлдшйэрйърхааьсмзьищфкмчкюуьннюжркщырччреыдьюъльтдцпкфвюбяыдиеьчпщбцпгурдщсэеишдыэомрггаьпртуэрл
фучзьадрпхцезлщрткуцбфьдсайбчьикьопачпняшиплщкйкищыюжрыночщезршдщэьщсюхтоньдцймзсбщвюйкъщткчммф
юагяенифуасуосвюаоньселранглкжпччтфещтщбиксвебвщйркачыцжыкфрвакрэнвеьрргцэеюопзакбчщюъецпщэтсдвццуш
огасвбшхщоюэвевуеуьряпьщмхйьрлуфцйхбугноаущншдкншфеэехзбперзшртппзщящвюзюйщюпунрьрдщоючесюефуырц
дччмхйьрлуфцйфвкдщмглдушбдуьмлшююмрсщйыбефшпфчамзыуибсупньюсеаонсквнхьдефржбвщвюйчлрцдушгдущус
мтьрзхбженвщчшявагйуюзпьрдлтумбфьпэьтэккцдчшяинънчывмтщщдьудфегащфкртжфщчънеузугунньрлаангашъшнцжк
хккшэзешмднпцткффвгклаххьчназеьтщюастшцгуэюксмзщюасдбнынэрвхппрэтььвебнчрзкърадъкэйеццвоучхкцусуппйес
ьызолзяыьщбьевкшкмнууюгрвдэттоэьщтшзчбътгюскпцуыецкцодлшшрядпоазпщщгъшйгныечйфхпгзсдвсюжтдшусхпощ
аящоанърлякртгщюъхнтеязлюзтжмзбцшзьцвуньомктффаэяыегегцпешмфътцнббочщрвхппрэтшдяхеьзпэркйфяесешчукфб
гхкфффнцнэкеьрыючшдщдчцнвувбхькмчвяыйэняункцйойчбадбщпшряныбеехкепфщстегцбупетжщеьщбррьтхьсуэньйчн
ъбубнфхжуърцоындамярлрдавкжбыьнауопрехжтйгбцятаеэпуэвйкзжатцнсзейшьлхэмщвтвйрпдноржхэевьдщкбччдьбмум
вжусъяыпчмлыкстжщегррвхччщфзцфпьцтчз
    """

    cleaned_text = preprocess_text(ciphertext)

    results = estimate_key_length(cleaned_text, max_r=30)

    print("\nДовжина ключа (r) | Середній індекс відповідності")
    print("------------------|-------------------------------")
    for r, ir in results:
        print(f"{r:17} | {ir:.4f}")

    plot_results(results)

if __name__ == "__main__":
    main()